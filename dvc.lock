schema: '2.0'
stages:
  normalize_weather_data:
    cmd: python ../../spoke/data_processing/01_normalizing_weather_data.py 2019-01-01
      2019-12-31
    deps:
    - path: ../raw_data/weather/
      md5: f67235592662850f4b0856767095f685.dir
      size: 24203989
      nfiles: 4
    outs:
    - path: weather_data_normalized.pkl.gz
      md5: 10cebf0be330be5ba61c9ad936958650
      size: 10916
  normalize_citibike_data:
    cmd: python ../../spoke/data_processing/04_normalizing_citibike_data.py 2019-01-01
      2019-12-31 100 10000
    deps:
    - path: ../raw_data/citibike/
      md5: b6ae53a779ce6556f3a4587ebcab0f06.dir
      size: 2464917000
      nfiles: 33
    - path: target_map.graphml
      md5: 27031ccc65677d649ac69a0194c338e2
      size: 2696141
    outs:
    - path: trip_data_normalized.pkl.gz
      md5: f344408426ebf34a790d4d51fb6d0061
      size: 1702594
  normalize_crash_data:
    cmd: python ../../spoke/data_processing/02_normalizing_crash_data.py 2019-01-01
      2019-12-31
    deps:
    - path: ../raw_data/Motor_Vehicle_Collisions_-_Crashes.csv
      md5: 84bd8d0baf1943f1f3bfe319f420a176
      size: 395108006
    outs:
    - path: crash_data_normalized.pkl.gz
      md5: 69fcc12ea38e758c632b9e8ab6e1f21b
      size: 591322
  join_crash_data_to_nodes:
    cmd: python ../../spoke/data_processing/03_joining_crash_data_to_nodes.py 100
    deps:
    - path: crash_data_normalized.pkl.gz
      md5: 69fcc12ea38e758c632b9e8ab6e1f21b
      size: 591322
    - path: target_map.graphml
      md5: 27031ccc65677d649ac69a0194c338e2
      size: 2696141
    outs:
    - path: crash_data_normalized_with_node_graph.pkl.gz
      md5: a4c9995592fce27e1baf5c24c64cedf3
      size: 88377
  join_all_data:
    cmd: python ../../spoke/data_processing/05_joining_all_data.py
    deps:
    - path: crash_data_normalized_with_node_graph.pkl.gz
      md5: a4c9995592fce27e1baf5c24c64cedf3
      size: 88377
    - path: trip_data_normalized.pkl.gz
      md5: f344408426ebf34a790d4d51fb6d0061
      size: 1702594
    - path: weather_data_normalized.pkl.gz
      md5: 10cebf0be330be5ba61c9ad936958650
      size: 10916
    outs:
    - path: unified_dataset.pkl.gz
      md5: 12c43e67600d01b0ce87d9c186414172
      size: 1357913
  create_map:
    cmd: python ../../spoke/data_processing/00_create_map.py mnh_below_34th
    outs:
    - path: target_map.graphml
      md5: 27031ccc65677d649ac69a0194c338e2
      size: 2696141
  associate_ctas_to_nodes:
    cmd: python ../../spoke/data_processing/06_associate_ctas_to_nodes.py
    deps:
    - path: ../raw_data/2010_Census_Tracts/geo_export_85c202c5-6ec9-493e-b0ec-a13efa26758d.shp
      md5: 0f6d2a4aaedc2e12f3db25f99d3f759e
      size: 2802360
    - path: target_map.graphml
      md5: 27031ccc65677d649ac69a0194c338e2
      size: 2696141
    - path: unified_dataset.pkl.gz
      md5: 12c43e67600d01b0ce87d9c186414172
      size: 1357913
    outs:
    - path: node_id_census_tract_key.pkl.gz
      md5: da9edc12e1ae2290a462c9b1d413e571
      size: 8948
  compute_danger:
    cmd: python ../../spoke/data_processing/07_compute_danger.py
    deps:
    - path: node_id_census_tract_key.pkl.gz
      md5: 54ee140b974a83495a4aa4e5e6b219ef
      size: 8948
    - path: target_map.graphml
      md5: 27031ccc65677d649ac69a0194c338e2
      size: 2696141
    - path: unified_dataset.pkl.gz
      md5: 12c43e67600d01b0ce87d9c186414172
      size: 1357913
    outs:
    - path: danger_by_node_id.pkl.gz
      md5: 5fdd2e436dfe56d19ece49070180d439
      size: 21428
    - path: target_map_consolidated.graphml
      md5: d0e771646b98acd7c0cbf288207778df
      size: 2396203
  generate_heatmaps:
    cmd: python ../../spoke/data_processing/08_generate_heatmaps.py
    deps:
    - path: danger_by_node_id.pkl.gz
      md5: 5fdd2e436dfe56d19ece49070180d439
      size: 21428
    - path: target_map_consolidated.graphml
      md5: d0e771646b98acd7c0cbf288207778df
      size: 2396203
  normalize_weather_data@2020:
    cmd: python ../../spoke/data_processing/01_normalizing_weather_data.py 2020-01-01
      2020-12-31
    deps:
    - path: ../raw_data/weather/
      md5: f67235592662850f4b0856767095f685.dir
      size: 24203989
      nfiles: 4
    outs:
    - path: weather_data_normalized.pkl.gz
      md5: d6a50536b326a79e9eaad91480c01ecb
      size: 10423
  normalize_weather_data@2021:
    cmd: python ../../spoke/data_processing/01_normalizing_weather_data.py 2021-01-01
      2021-11-01
    deps:
    - path: ../raw_data/weather/
      md5: f67235592662850f4b0856767095f685.dir
      size: 24203989
      nfiles: 4
    outs:
    - path: weather_data_normalized.pkl.gz
      md5: 25515b3b3d0b12cf56fc8d953a8167e2
      size: 9130
  create_map@2021:
    cmd: python ../../spoke/data_processing/00_create_map.py mnh_below_34th
    outs:
    - path: target_map.graphml
      md5: 6524b14355e739e02158bc2c23da0699
      size: 2696141
  normalize_crash_data@2021:
    cmd: python ../../spoke/data_processing/02_normalizing_crash_data.py 2021-01-01
      2021-11-01
    deps:
    - path: ../raw_data/Motor_Vehicle_Collisions_-_Crashes.csv
      md5: 84bd8d0baf1943f1f3bfe319f420a176
      size: 395108006
    outs:
    - path: crash_data_normalized.pkl.gz
      md5: 49d503a1b348fa02b5264c0c42b94d57
      size: 412062
  join_crash_data_to_nodes@2021:
    cmd: python ../../spoke/data_processing/03_joining_crash_data_to_nodes.py 100
    deps:
    - path: crash_data_normalized.pkl.gz
      md5: 49d503a1b348fa02b5264c0c42b94d57
      size: 412062
    - path: target_map.graphml
      md5: 6524b14355e739e02158bc2c23da0699
      size: 2696141
    outs:
    - path: crash_data_normalized_with_node_graph.pkl.gz
      md5: a8c62f4c14425db1e7fb03f5e0005ce3
      size: 59153
  normalize_citibike_data@2021:
    cmd: python ../../spoke/data_processing/04_normalizing_citibike_data.py 2021-01-01
      2021-11-01 100 10000
    deps:
    - path: ../raw_data/citibike/
      md5: b6ae53a779ce6556f3a4587ebcab0f06.dir
      size: 2464917000
      nfiles: 33
    - path: target_map.graphml
      md5: 6524b14355e739e02158bc2c23da0699
      size: 2696141
    outs:
    - path: trip_data_normalized.pkl.gz
      md5: a439ad9427929dca4d1da97c7aa5d9f2
      size: 1662365
  join_all_data@2021:
    cmd: python ../../spoke/data_processing/05_joining_all_data.py
    deps:
    - path: crash_data_normalized_with_node_graph.pkl.gz
      md5: a8c62f4c14425db1e7fb03f5e0005ce3
      size: 59153
    - path: trip_data_normalized.pkl.gz
      md5: a439ad9427929dca4d1da97c7aa5d9f2
      size: 1662365
    - path: weather_data_normalized.pkl.gz
      md5: 25515b3b3d0b12cf56fc8d953a8167e2
      size: 9130
    outs:
    - path: unified_dataset.pkl.gz
      md5: 603fe811a70215e7a99146ece9dfac8c
      size: 1005
  associate_ctas_to_nodes@2021:
    cmd: python ../../spoke/data_processing/06_associate_ctas_to_nodes.py
    deps:
    - path: ../raw_data/2010_Census_Tracts/geo_export_85c202c5-6ec9-493e-b0ec-a13efa26758d.shp
      md5: 0f6d2a4aaedc2e12f3db25f99d3f759e
      size: 2802360
    - path: target_map.graphml
      md5: 6524b14355e739e02158bc2c23da0699
      size: 2696141
    - path: unified_dataset.pkl.gz
      md5: 603fe811a70215e7a99146ece9dfac8c
      size: 1005
    outs:
    - path: node_id_census_tract_key.pkl.gz
      md5: 5b455978f7c08e37dc23637255461e4d
      size: 8948
  create_map@2019:
    cmd: python ../../spoke/data_processing/00_create_map.py mnh_below_34th
    outs:
    - path: target_map.graphml
      md5: de3666535bc7dd8d6d02a55f61ba7a13
      size: 2696141
  normalize_weather_data@2019:
    cmd: python ../../spoke/data_processing/01_normalizing_weather_data.py 2019-01-01
      2019-12-31
    deps:
    - path: ../raw_data/weather/
      md5: f67235592662850f4b0856767095f685.dir
      size: 24203989
      nfiles: 4
    outs:
    - path: weather_data_normalized.pkl.gz
      md5: 10cebf0be330be5ba61c9ad936958650
      size: 10916
  normalize_crash_data@2019:
    cmd: python ../../spoke/data_processing/02_normalizing_crash_data.py 2019-01-01
      2019-12-31
    deps:
    - path: ../raw_data/Motor_Vehicle_Collisions_-_Crashes.csv
      md5: 84bd8d0baf1943f1f3bfe319f420a176
      size: 395108006
    outs:
    - path: crash_data_normalized.pkl.gz
      md5: 69fcc12ea38e758c632b9e8ab6e1f21b
      size: 591322
  join_crash_data_to_nodes@2019:
    cmd: python ../../spoke/data_processing/03_joining_crash_data_to_nodes.py 100
    deps:
    - path: crash_data_normalized.pkl.gz
      md5: 69fcc12ea38e758c632b9e8ab6e1f21b
      size: 591322
    - path: target_map.graphml
      md5: de3666535bc7dd8d6d02a55f61ba7a13
      size: 2696141
    outs:
    - path: crash_data_normalized_with_node_graph.pkl.gz
      md5: 69bce8868c63761613defd19871437f1
      size: 88377
  normalize_citibike_data@2019:
    cmd: python ../../spoke/data_processing/04_normalizing_citibike_data.py 2019-01-01
      2019-12-31 100 10000
    deps:
    - path: ../raw_data/citibike/
      md5: b6ae53a779ce6556f3a4587ebcab0f06.dir
      size: 2464917000
      nfiles: 33
    - path: target_map.graphml
      md5: de3666535bc7dd8d6d02a55f61ba7a13
      size: 2696141
    outs:
    - path: trip_data_normalized.pkl.gz
      md5: af9874c7872b57ff7c241e2c1909fb54
      size: 1702594
  join_all_data@2019:
    cmd: python ../../spoke/data_processing/05_joining_all_data.py
    deps:
    - path: crash_data_normalized_with_node_graph.pkl.gz
      md5: 69bce8868c63761613defd19871437f1
      size: 88377
    - path: trip_data_normalized.pkl.gz
      md5: af9874c7872b57ff7c241e2c1909fb54
      size: 1702594
    - path: weather_data_normalized.pkl.gz
      md5: 10cebf0be330be5ba61c9ad936958650
      size: 10916
    outs:
    - path: unified_dataset.pkl.gz
      md5: 38eb175ac3d6d306c00ae238b81f3705
      size: 1357913
  associate_ctas_to_nodes@2019:
    cmd: python ../../spoke/data_processing/06_associate_ctas_to_nodes.py
    deps:
    - path: ../raw_data/2010_Census_Tracts/geo_export_85c202c5-6ec9-493e-b0ec-a13efa26758d.shp
      md5: 0f6d2a4aaedc2e12f3db25f99d3f759e
      size: 2802360
    - path: target_map.graphml
      md5: de3666535bc7dd8d6d02a55f61ba7a13
      size: 2696141
    - path: unified_dataset.pkl.gz
      md5: 38eb175ac3d6d306c00ae238b81f3705
      size: 1357913
    outs:
    - path: node_id_census_tract_key.pkl.gz
      md5: e37b3439adcac5a1f686356db92562a2
      size: 8948
  compute_danger@2019:
    cmd: python ../../spoke/data_processing/07_compute_danger.py
    deps:
    - path: node_id_census_tract_key.pkl.gz
      md5: e37b3439adcac5a1f686356db92562a2
      size: 8948
    - path: target_map.graphml
      md5: de3666535bc7dd8d6d02a55f61ba7a13
      size: 2696141
    - path: unified_dataset.pkl.gz
      md5: 38eb175ac3d6d306c00ae238b81f3705
      size: 1357913
    outs:
    - path: danger_by_node_id.pkl.gz
      md5: c2794b25303ae5b10d5da6ffabdf39f8
      size: 21428
    - path: target_map_consolidated.graphml
      md5: 8425d2d5dbc2ce4080e4c8deb41e7119
      size: 2396203
  create_map@2020:
    cmd: python ../../spoke/data_processing/00_create_map.py mnh_below_34th
    outs:
    - path: target_map.graphml
      md5: f14986bb00bfdf254cc6594271fad4bd
      size: 2696141
  normalize_crash_data@2020:
    cmd: python ../../spoke/data_processing/02_normalizing_crash_data.py 2020-01-01
      2020-12-31
    deps:
    - path: ../raw_data/Motor_Vehicle_Collisions_-_Crashes.csv
      md5: 84bd8d0baf1943f1f3bfe319f420a176
      size: 395108006
    outs:
    - path: crash_data_normalized.pkl.gz
      md5: 849b6a9b50588c14043aa12612a2e3cd
      size: 476706
  join_crash_data_to_nodes@2020:
    cmd: python ../../spoke/data_processing/03_joining_crash_data_to_nodes.py 100
    deps:
    - path: crash_data_normalized.pkl.gz
      md5: 849b6a9b50588c14043aa12612a2e3cd
      size: 476706
    - path: target_map.graphml
      md5: f14986bb00bfdf254cc6594271fad4bd
      size: 2696141
    outs:
    - path: crash_data_normalized_with_node_graph.pkl.gz
      md5: bb9def971b138bb3e6e4793b96b006be
      size: 57893
  normalize_citibike_data@2020:
    cmd: python ../../spoke/data_processing/04_normalizing_citibike_data.py 2020-01-01
      2020-12-31 100 10000
    deps:
    - path: ../raw_data/citibike/
      md5: b6ae53a779ce6556f3a4587ebcab0f06.dir
      size: 2464917000
      nfiles: 33
    - path: target_map.graphml
      md5: f14986bb00bfdf254cc6594271fad4bd
      size: 2696141
    outs:
    - path: trip_data_normalized.pkl.gz
      md5: 03322ce80af460e45ccb4a695ea8ed2f
      size: 1706472
  join_all_data@2020:
    cmd: python ../../spoke/data_processing/05_joining_all_data.py
    deps:
    - path: crash_data_normalized_with_node_graph.pkl.gz
      md5: bb9def971b138bb3e6e4793b96b006be
      size: 57893
    - path: trip_data_normalized.pkl.gz
      md5: 03322ce80af460e45ccb4a695ea8ed2f
      size: 1706472
    - path: weather_data_normalized.pkl.gz
      md5: d6a50536b326a79e9eaad91480c01ecb
      size: 10423
    outs:
    - path: unified_dataset.pkl.gz
      md5: ef05b4beb6f2a1a9c2752ee9ef6f4777
      size: 1352927
  associate_ctas_to_nodes@2020:
    cmd: python ../../spoke/data_processing/06_associate_ctas_to_nodes.py
    deps:
    - path: ../raw_data/2010_Census_Tracts/geo_export_85c202c5-6ec9-493e-b0ec-a13efa26758d.shp
      md5: 0f6d2a4aaedc2e12f3db25f99d3f759e
      size: 2802360
    - path: target_map.graphml
      md5: f14986bb00bfdf254cc6594271fad4bd
      size: 2696141
    - path: unified_dataset.pkl.gz
      md5: ef05b4beb6f2a1a9c2752ee9ef6f4777
      size: 1352927
    outs:
    - path: node_id_census_tract_key.pkl.gz
      md5: 188c9821ddb02cf3d2cf6fca1656d3ea
      size: 8948
  compute_danger@2020:
    cmd: python ../../spoke/data_processing/07_compute_danger.py
    deps:
    - path: node_id_census_tract_key.pkl.gz
      md5: 188c9821ddb02cf3d2cf6fca1656d3ea
      size: 8948
    - path: target_map.graphml
      md5: f14986bb00bfdf254cc6594271fad4bd
      size: 2696141
    - path: unified_dataset.pkl.gz
      md5: ef05b4beb6f2a1a9c2752ee9ef6f4777
      size: 1352927
    outs:
    - path: danger_by_node_id.pkl.gz
      md5: 17dd75248899b18298eb14746bce89a1
      size: 20172
    - path: target_map_consolidated.graphml
      md5: 6556de0fd07b28f19d49b8e7bf7fa636
      size: 2396203
  generate_heatmaps@2019:
    cmd: python ../../spoke/data_processing/08_generate_heatmaps.py
    deps:
    - path: danger_by_node_id.pkl.gz
      md5: c2794b25303ae5b10d5da6ffabdf39f8
      size: 21428
    - path: target_map_consolidated.graphml
      md5: 8425d2d5dbc2ce4080e4c8deb41e7119
      size: 2396203
  generate_heatmaps@2020:
    cmd: python ../../spoke/data_processing/08_generate_heatmaps.py
    deps:
    - path: danger_by_node_id.pkl.gz
      md5: 17dd75248899b18298eb14746bce89a1
      size: 20172
    - path: target_map_consolidated.graphml
      md5: 6556de0fd07b28f19d49b8e7bf7fa636
      size: 2396203
